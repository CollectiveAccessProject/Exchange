<div class="row">
  <div class="col-sm-12">
    <H4>
      <% if (params['mode'] == :preview) %>
          Previewing Resource
      <% end %>
      <%= link_to '<span class="glyphicon glyphicon-edit aria-hidden="true"></span> Edit'.html_safe, edit_resource_path(@resource), class:'btn btn-default btn-xs pull-right' %>&nbsp;&nbsp;<%= link_to '<span class="glyphicon glyphicon-arrow-up aria-hidden="true"></span> Back'.html_safe, '/dashboard', class:'btn btn-default btn-xs pull-right' %>
    </H4>
  </div><!-- end col -->
</div><!-- end row -->
<div class="row">
  <div class="col-sm-10">
    <p id="notice"><%= notice %></p>

    <H2><%= @resource.title %></H2>

    <H3><%= @resource.subtitle %></H3>

    <div class="row">
      <% @resource.media_files.each do |f| %>
          <div class="col-md-2">
            <% if f.sourceable %>
                <div class="thumbnail previewThumbnail">
                  <a href="#" data-toggle="modal" data-target="#<%= f.sourceable.class.to_s + f.sourceable.id.to_s %>">
                    <%= f.sourceable.preview :thumbnail  %>
                  </a>
                  <div class="caption small">
                    <b><%= f.caption  %></b><br/>
                  </div>
                </div>
                <%=
                  # this renders a bootstrap model that is triggered if you click on the preview above
                  # it's in a partial because it's about a billion nested divs :-)
                  render partial: 'media_file_render_overlay', locals: { media: f.sourceable.render, media_id: f.id.to_s,  modal_id: f.sourceable.class.to_s + f.sourceable.id.to_s, editable: false }
                %>
            <% else %>
                <p><%= f.caption  %></p>
            <% end %>
          </div><!-- end col -->
      <% end %>

    </div><!-- end row -->
    <p><%= @resource.parsed_body_text.html_safe %></p>
    <% if @resource.comments.count > 0 %>
        <H3><%= @resource.comments.count %> Comment<%= @resource.comments.count == 1 ? '' : 's' %></H3>
        <div class="panel panel-primary">
          <div class="panel-body">
            <% @resource.comments.each do |c| %>
                <p><%= c.comment %><br/><small>&mdash; by <i><%= c.user_name %> (<%= c.updated_at.to_time.strftime(Rails.application.config.x.timestamp_format) %>)</i></small></p><HR/>
            <% end %>
          </div><!-- end panel-body -->
        </div><!-- end panel -->
    <% end %>
    <H4>Add your comment and tags</H4>
    <div class="panel panel-primary">
      <div class="panel-body">
        <div class="row">
          <div class="col-sm-6">
            <%= form_tag '/resources/add_comment' do %>
                <%= hidden_field_tag 'id', @resource.id %>
                <div class="form-group">
                  <label>Comment</label>
                  <%= text_area_tag 'comment[comment]', nil, class:'form-control' %>
                </div>
                <%= submit_tag 'Save', class:'btn btn-default btn-sm' %>
            <% end %>
          </div><!-- end col -->
          <div class="col-sm-6">
            <%= form_tag '/resources/add_tag' do %>
                <%= hidden_field_tag 'id', @resource.id %>
                <div class="form-group">
                  <label>Tag</label>
                  <%= text_field_tag 'tag[tag]', nil, class:'form-control' %>
                </div>
                <%= submit_tag 'Save', class:'btn btn-default btn-sm' %>
            <% end %>
          </div><!-- end col -->
        </div><!-- end row -->
      </div><!-- end panel-body -->
    </div><!-- end panel -->
  </div><!-- end col -->
  <div class="col-sm-2">
    <% if @resource.tags.count > 0 %>
        <p>
          <strong>Tags:</strong>
        <ul>
          <% @resource.tags.each do |t| %>
              <li><%= t.tag %></li>
          <% end %>
        </ul>
        </p>
    <% end %>
  </div><!-- end col -->
</div><!-- end row -->