<%
	media_file_list = []
	@resource.media_files.each do |sf|
      	media_file_list.push(sf)
    end
%>
<% @resource.media_files.each do |f| %>
    <% if f.sourceable %>
    	<%
    		begin
              media_display = f.sourceable.render :large
            rescue
              media_display = f.sourceable.preview :large, '', '', f.caption
            end
    		target_div = '#' + f.sourceable.class.to_s + f.sourceable.id.to_s
		  	anchor_tag = f.sourceable.class.to_s + f.sourceable.id.to_s + 'Link'
    	%>
        <div class="mediaListIcon" data-media_id="<%= f.id %>" data-access="<%= f.access %>">
          <%= link_to '<i class="fa fa-times" aria-hidden="true"></i>'.html_safe, f, method: :delete, remote: true, data: {confirm: 'Are you sure you want to delete this media?'}, class: 'cornerButton' %>
    	  <%= link_to (f.sourceable.preview :thumbnail), load_media_modal_path(:target_div => target_div, :media_display => media_display, :media_id => f.id.to_s, :resource_title => @resource.title, :media_files => media_file_list, :editable => true, :resource_id => @resource.id), :remote => true, :class => 'mediaLoad', :id => anchor_tag, :'data-modal-target' => target_div %>
    	  <small class="slug_<%= f.sourceable.id.to_s %>"><%= sanitize(f.caption) %> (<em><%= f.slug %></em>)</small>
        </div>
        <%=
          # this renders a bootstrap model that is triggered if you click on the preview above
          # it's in a partial because it's about a billion nested divs :-)
          # This modal is intentionally commented out and has been moved to the parent of this partial: edit.html.erb
          # This was done to avoid an issue with text field clipping and the summernote plugin
          # render partial: 'resources/media_file_render_overlay', locals: {media: f.sourceable.render, media_id: f.id.to_s,  modal_id: f.sourceable.class.to_s + f.sourceable.id.to_s, editable: true}
        %>
    <% end %>
<% end %>
<script type="text/javascript">
  jQuery(document).ready(function() {
    jQuery("#resource_media_list").sortable();
  });
  exchangeLoadMediaForSummernote();
</script>