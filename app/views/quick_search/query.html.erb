<% content_for :page_title do %>
    <title>Exchange|Search: <%= sanitize(@query, :tags => %w()) %></title>
<% end %>
<div class="row">
  <div class="col-md-12">
    <% if((@collections.total_entries == 0) && (@resources.total_entries == 0) && (@collection_objects.total_entries == 0) && (@exhibitions.total_entries == 0) && (@crc_sets.total_entries == 0)) %>
        <h2>No results found for <em><%= sanitize(@query) %></em></h2>
    <% else %>
        <div class="pull-right"><i class="fa fa-eye-slash" aria-hidden="true"></i> Not available to public </div>
        <% if sanitize(@query) =~ /role:[a-zA-Z0-9 _-]+/ %>
            <h2>Browsing by <%= sanitize(@query.gsub(/([a-zA-Z]+:)([a-zA-Z0-9 _-]+)/, 'Affiliation: <em>\2</em>'))%></h2>
        <% elsif sanitize(@query) =~ /keyword:[a-zA-Z0-9 _-]+/ %>
            <h2>Browsing by <%= sanitize(@query.gsub(/([a-zA-Z]+:)([a-zA-Z0-9 _-]+)/, 'Keyword: <em>\2</em>'))%></h2>
        <% elsif sanitize(@query) =~ /tag:[a-zA-Z0-9 _-]+/ %>
            <h2>Browsing by <%= sanitize(@query.gsub(/([a-zA-Z]+:)([a-zA-Z0-9 _-]+)/, 'Tag: <em>\2</em>'))%></h2>
        <% elsif sanitize(@query) =~ /author_id:[a-zA-Z0-9 _-]+/ %>
            <% author = User.find(@query.split(':')[1]) %>
            <h2><%= sanitize(@query.gsub(/([a-zA-Z _-]+:)([a-zA-Z0-9 _-]+)/, 'Resources &amp; Learning Collections Created by: ')) + '<em>'.html_safe + author.name  + '</em>'.html_safe%></h2>
        <% else %>
            <h2>Results for <%= sanitize(@query) %></h2>
        <% end %>
    <% end %>
  </div>
</div>

<div class="row" class="row" id="quick_search_tabs">
  <div class="col-md-12">
    <ul class="nav nav-tabs">
        <% 
            active = nil
            if(@collection_objects.total_entries > 0) 
        %>
            <li <%= (active.nil? ? "class='active'" : "").html_safe %>>
                <a data-toggle="tab" href="#tab_collection_object_results">UMMA objects (<%= @collection_objects.total_entries %>)</a>
            </li> 
            <%  active = 'collection_objects' if active.nil? %>    
        <% end %>
        <% if(@resources.total_entries > 0) %>
            <li <%= (active.nil? ? "class='active'" : "").html_safe %>>
                <a data-toggle="tab" href="#tab_resource_results">Resources  (<%= @resources.total_entries %>)</a>
            </li>    
            <% active = 'resources' if active.nil? %>    
        <% end %>
        <% if(@collections.total_entries > 0) %>
            <li <%= (active.nil? ? "class='active'" : "").html_safe %>>
                <a data-toggle="tab" href="#tab_collection_results">Learning collections  (<%= @collections.total_entries %>)</a>
            </li>   
            <% active = 'collections' if active.nil? %>     
        <% end %>
        <% if(@is_staff && @crc_sets.total_entries > 0) %>
            <li <%= (active.nil? ? "class='active'" : "").html_safe %>>
                <a data-toggle="tab" href="#tab_crc_set_results">CRC Sets  (<%= @crc_sets.total_entries %>)</a>
            </li> 
            <% active = 'crc_sets' if active.nil? %>       
        <% end %>
        <% if(@exhibitions.total_entries > 0) %>
            <li <%= (active.nil? ? "class='active'" : "").html_safe %>>
                <a data-toggle="tab" href="#tab_exhibition_results">Exhibitions (<%= @exhibitions.total_entries %>)</a>
            </li>  
            <% active = 'exhibitions' if active.nil? %>      
        <% end %>
    </ul>

    <div class="tab-content" id="query_search_content">
        <% if(@collection_objects.total_entries > 0) %>
            <div id="tab_collection_object_results" class="tab-pane <%= ((active == 'collection_objects') ? "active" : "").html_safe %>">
                <%= render :partial => "quick_search/collection_object_results" %>
            </div>
        <% end %>
        <% if(@resources.total_entries > 0) %>
            <div id="tab_resource_results" class="tab-pane <%= ((active == 'resources') ? "active" : "").html_safe %>">
                <%= render :partial => "quick_search/resource_results" %>
            </div>
        <% end %>
        <% if(@collections.total_entries > 0) %>
            <div id="tab_collection_results" class="tab-pane <%= ((active == 'collections') ? "active" : "").html_safe %>">
                <%= render :partial => "quick_search/collection_results" %>
            </div>
        <% end %>
        <% if(@is_staff && @crc_sets.total_entries > 0) %>
            <div id="tab_crc_set_results" class="tab-pane <%= ((active == 'crc_sets') ? "active" : "").html_safe %>">
                <%= render :partial => "quick_search/crc_set_results" %>
            </div>
        <% end %>
        <% if(@exhibitions.total_entries > 0) %>
            <div id="tab_exhibition_results" class="tab-pane <%= ((active == 'exhibitions') ? "active" : "").html_safe %>">
                <%= render :partial => "quick_search/exhibition_results" %>
            </div>
        <% end %>
    </div>
  </div><!-- end col -->
</div><!-- end row -->